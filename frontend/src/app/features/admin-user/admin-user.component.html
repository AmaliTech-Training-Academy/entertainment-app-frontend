<div class="user-management">
  <h2>User Management</h2>

  <div class="filters-and-actions">
    <div class="filter-section">
      <label for="role-select">Filter by Role:</label>
      <select id="role-select" [(ngModel)]="selectedRole" (change)="filterByRole()">
        <option value="ALL">All</option>
        <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
      </select>
    </div>

    <div class="bulk-actions" *ngIf="selectedUsers.length > 0">
      <label for="new-role-select">Change selected users to:</label>
      <select id="new-role-select" [(ngModel)]="newRole">
        <option value="" disabled>Select Role</option>
        <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
      </select>
      <button 
        (click)="changeSelectedUsersRole()" 
        [disabled]="!newRole || selectedUsers.length === 0"
        class="change-role-btn">
        Change Role ({{ selectedUsers.length }} selected)
      </button>
      <button (click)="clearSelection()" class="clear-selection-btn">
        Clear Selection
      </button>
    </div>
  </div>

  <table>
    <thead>
      <tr>
        <th>
          <input 
            type="checkbox" 
            [checked]="isAllSelected()" 
            [indeterminate]="isIndeterminate()"
            (change)="toggleSelectAll($event)"
            id="select-all">
          <label for="select-all">Select All</label>
        </th>
        <th>Name</th>
        <th>Username</th>
        <th>Email</th>
        <th>Role</th>
        <th>Created At</th>
        <th>Last Updated</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let user of filteredUsers" 
          [ngClass]="{ 'banned-user': user.roles.includes('ROLE_BANNED'), 'selected-row': selectedUsers.includes(user.id) }">
        <td>
          <input 
            type="checkbox" 
            [checked]="selectedUsers.includes(user.id)"
            (change)="toggleUserSelection(user.id, $event)"
            [disabled]="user.roles.includes('ROLE_BANNED')"
            [id]="'user-' + user.id">
          <label [for]="'user-' + user.id" class="sr-only">Select {{ user.username }}</label>
        </td>
        <td>{{ user.firstName }} {{ user.lastName }}</td>
        <td>{{ user.username }}</td>
        <td>{{ user.email }}</td>
        <td>
          <span class="role-badge" [ngClass]="getRoleClass(user.roles[0])">
            {{ user.roles[0] }}
          </span>
        </td>
        <td>{{ user.createdAt | date: 'medium' }}</td>
        <td>{{ user.lastUpdatedAt | date: 'medium' }}</td>
        <td>
          <button 
            (click)="toggleUserBan(user.id)" 
            [ngClass]="{ 'ban-btn': !user.roles.includes('ROLE_BANNED'), 'unban-btn': user.roles.includes('ROLE_BANNED') }">
            {{ user.roles.includes('ROLE_BANNED') ? 'Unban' : 'Ban' }}
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <div class="selected-info" *ngIf="selectedUsers.length > 0">
    <p>{{ selectedUsers.length }} user(s) selected</p>
  </div>
</div>